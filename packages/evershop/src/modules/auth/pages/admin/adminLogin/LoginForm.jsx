import PropTypes from 'prop-types';
import React from 'react';
import { Field } from '@components/common/form/Field';
import { Form } from '@components/common/form/Form';
import './LoginForm.scss';
import Area from '@components/common/Area';

export default function LoginForm({ authUrl, dashboardUrl }) {
  const [error, setError] = React.useState(null);

  const onSuccess = (response) => {
    if (!response.error) {
      window.location.href = dashboardUrl;
    } else {
      setError(response.error.message);
    }
  };

  return (
    <div className="admin-login-form">
      <div className="flex items-center justify-center mb-12">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="60"
          height="56"
          viewBox="0 0 60 56"
          fill="none"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M27.4489 53.0226C27.367 53.0233 27.2849 53.0237 27.2028 53.0237C20.4359 53.0237 14.2574 50.5443 9.55422 46.4584C5.47623 41.8477 3.00699 35.8227 3.00699 29.2301C3.00699 21.5029 6.39927 14.5555 11.7982 9.75125C7.92238 14.3773 5.59441 20.3061 5.59441 26.7699C5.59441 39.753 14.9863 50.5774 27.4489 53.0226ZM30 52.8811C16.5807 51.5051 6.11888 40.3398 6.11888 26.7699C6.11888 19.196 9.37793 12.3712 14.5913 7.57941C18.8838 4.67579 24.0829 2.97634 29.6853 2.97634C36.4522 2.97634 42.6307 5.45566 47.3339 9.54156C51.4119 14.1523 53.8811 20.1773 53.8811 26.7699C53.8811 40.3398 43.4193 51.5051 30 52.8811ZM30 53.4C29.0804 53.4924 28.1472 53.5398 27.2028 53.5398C21.7532 53.5398 16.6779 51.9628 12.4223 49.2473C17.0752 53.1371 23.1018 55.4839 29.6853 55.4839C35.4469 55.4839 40.7819 53.6865 45.1429 50.6305C41.4378 52.4907 37.242 53.5398 32.7972 53.5398C31.8528 53.5398 30.9196 53.4924 30 53.4ZM47.8912 48.4206C43.5988 51.3242 38.3997 53.0237 32.7972 53.0237C32.7151 53.0237 32.633 53.0233 32.5511 53.0226C45.0137 50.5774 54.4056 39.753 54.4056 26.7699C54.4056 21.4745 52.8432 16.5382 50.1473 12.3832C54.0276 16.9424 56.3636 22.8178 56.3636 29.2301C56.3636 36.804 53.1046 43.6288 47.8912 48.4206ZM48.2204 48.8243C43.3626 53.2764 36.8471 56 29.6853 56C21.505 56 14.168 52.4467 9.18126 46.8229C3.55009 41.9183 0 34.7521 0 26.7699C0 11.9853 12.1791 0 27.2028 0C28.1472 0 29.0804 0.047361 30 0.139801C30.9196 0.047361 31.8528 0 32.7972 0C47.8209 0 60 11.9853 60 26.7699C60 35.9189 55.3361 43.996 48.2204 48.8243ZM32.5511 0.517223C32.633 0.516494 32.7151 0.516129 32.7972 0.516129C47.5312 0.516129 59.4755 12.2703 59.4755 26.7699C59.4755 34.4971 56.0832 41.4445 50.6843 46.2488C54.5601 41.6227 56.8881 35.694 56.8881 29.2301C56.8881 21.2479 53.338 14.0817 47.7069 9.17712C43.836 4.81184 38.5492 1.69404 32.5511 0.517223ZM30 0.65871C35.4876 1.22137 40.4805 3.42105 44.4658 6.75274C40.2103 4.0372 35.1349 2.46022 29.6853 2.46022C25.2405 2.46022 21.0447 3.50927 17.3396 5.3695C20.9856 2.81454 25.3124 1.13936 30 0.65871ZM27.4489 0.517223C22.4129 1.50528 17.8783 3.8616 14.2621 7.17571C7.1464 12.004 2.48252 20.0811 2.48252 29.2301C2.48252 34.5255 4.04491 39.4618 6.7408 43.6168C2.86052 39.0576 0.524476 33.1822 0.524476 26.7699C0.524476 12.2703 12.4688 0.516129 27.2028 0.516129C27.2849 0.516129 27.367 0.516494 27.4489 0.517223ZM16.2762 27.9989C16.2762 29.2012 16.412 30.3813 16.6836 31.5391C17.5436 35.3687 19.4447 38.1963 22.3869 40.0221C24.6048 41.358 27.1623 42.0037 30.0592 41.9591C34.495 41.9146 37.8672 40.5564 40.1757 37.8846C42.5294 35.1683 43.7063 31.8953 43.7063 28.0657C43.7063 24.2361 42.5973 21.0077 40.3794 18.3804C37.8899 15.4859 34.4271 14.0387 29.9913 14.0387C27.0944 14.0387 24.6048 14.7067 22.5227 16.0426C20.4858 17.3339 18.9242 19.0484 17.8378 21.1858C16.7968 23.3232 16.2762 25.5943 16.2762 27.9989ZM37.8672 33.0754C37.4146 34.4558 36.9619 35.5468 36.5093 36.3483C34.9703 39.1092 32.775 40.4896 29.9234 40.4896C27.0717 40.4896 24.0417 39.1092 22.5479 36.3483C21.3258 34.0773 20.6921 31.2719 20.6469 27.9321C20.6016 24.5478 21.2127 21.7202 22.4801 19.4491C23.9285 16.8219 27.0038 15.5082 29.9913 15.5082C31.8924 15.5082 33.4992 16.1094 34.8119 17.3117C37.3014 19.6272 38.5462 23.4346 38.5462 28.7337C38.5462 30.2477 38.3199 31.6949 37.8672 33.0754Z"
            fill="black"
          />
        </svg>
      </div>
      {error && <div className="text-critical py-4">{error}</div>}
      <Form
        action={authUrl}
        method="POST"
        id="adminLoginForm"
        isJSON
        onSuccess={onSuccess}
        btnText="SIGN IN"
      >
        <Area
          id="adminLoginForm"
          coreComponents={[
            {
              component: {
                default: Field
              },
              props: {
                name: 'email',
                type: 'email',
                label: 'Email',
                placeholder: 'Email',
                validationRules: ['notEmpty', 'email']
              },
              sortOrder: 10
            },
            {
              component: {
                default: Field
              },
              props: {
                name: 'password',
                type: 'password',
                label: 'Password',
                placeholder: 'Password',
                validationRules: ['notEmpty']
              },
              sortOrder: 20
            }
          ]}
          noOuter
        />
      </Form>
    </div>
  );
}

LoginForm.propTypes = {
  authUrl: PropTypes.string.isRequired,
  dashboardUrl: PropTypes.string.isRequired
};

export const layout = {
  areaId: 'content',
  sortOrder: 10
};

export const query = `
  query Query {
    authUrl: url(routeId: "adminLoginJson")
    dashboardUrl: url(routeId: "dashboard")
  }
`;
